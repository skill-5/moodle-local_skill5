define("local_skill5/landing_handshake",["exports","core/notification"],(function(_exports,_notification){var obj;
/**
   * Landing page handshake module for Skill5 integration.
   *
   * @module     local_skill5/landing_handshake
   * @copyright  2025 Skill5
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_notification=(obj=_notification)&&obj.__esModule?obj:{default:obj};_exports.init=(skill5Origin,connectUrl,connectionAssistantUrl)=>{window.console.log("[Moodle] Handshake listener is active."),window.addEventListener("message",(event=>{if(event.origin!==skill5Origin)return void window.console.warn("[Moodle] Message from unexpected origin ignored:",event.origin);const message=event.data;if(window.console.log("[Moodle] Received message:",message),message&&message.type)switch(message.type){case"SKILL5_IFRAME_READY":window.console.log("[Moodle] Received SKILL5_IFRAME_READY. Sending acknowledgment..."),event.source.postMessage({type:"MOODLE_LISTENER_READY"},event.origin);break;case"SKILL5_SEND_EMAIL":message.payload&&message.payload.email?handleEmailPayload(message.payload.email,connectUrl,connectionAssistantUrl):window.console.error("[Moodle] Email payload is missing or invalid:",message.payload)}}))};const handleEmailPayload=(adminEmail,connectUrl,connectionAssistantUrl)=>{window.console.log("[Moodle] Received email payload:",adminEmail),window.console.log("[Moodle] Calling connect.php via fetch...");const url="".concat(connectUrl,"?email=").concat(encodeURIComponent(adminEmail));fetch(url,{method:"GET",credentials:"same-origin"}).then((response=>(window.console.log("[Moodle] Connect.php response received"),response.ok?(window.console.log("[Moodle] Redirecting to connection_assistant.php"),void(window.location.href=connectionAssistantUrl)):(window.console.error("[Moodle] Connect.php returned error:",response.status),_notification.default.alert("Connection Error","Connection failed. Please try again or contact support.","OK"))))).catch((error=>(window.console.error("[Moodle] Error calling connect.php:",error),_notification.default.alert("Connection Error","Connection failed. Please try again or contact support.","OK"))))}}));

//# sourceMappingURL=landing_handshake.min.js.map