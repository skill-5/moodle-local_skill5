/*! moodle-local_skill5 2026-01-12 */
define(["exports","core/ajax","core/notification"],function(o,e,i){function n(o){return o&&o.__esModule?o:{default:o}}Object.defineProperty(o,"__esModule",{value:!0}),o.init=void 0,e=n(e),i=n(i);o.init=function(n,i,a){window.console.log("[Moodle] Handshake listener is active."),window.addEventListener("message",function(o){if(o.origin!==n)window.console.warn("[Moodle] Message from unexpected origin ignored:",o.origin);else{var e=o.data;if(window.console.log("[Moodle] Received message:",e),e&&e.type)switch(e.type){case"SKILL5_IFRAME_READY":window.console.log("[Moodle] Received SKILL5_IFRAME_READY. Sending acknowledgment..."),o.source.postMessage({type:"MOODLE_LISTENER_READY"},o.origin);break;case"SKILL5_SEND_EMAIL":e.payload&&e.payload.email?t(e.payload.email,i,a):window.console.error("[Moodle] Email payload is missing or invalid:",e.payload)}}})};var t=function(o,e,n){window.console.log("[Moodle] Received email payload:",o),window.console.log("[Moodle] Calling connect.php via fetch...");e="".concat(e,"?email=").concat(encodeURIComponent(o));fetch(e,{method:"GET",credentials:"same-origin"}).then(function(o){window.console.log("[Moodle] Connect.php response received"),o.ok?(window.console.log("[Moodle] Redirecting to connection_assistant.php"),window.location.href=n):(window.console.error("[Moodle] Connect.php returned error:",o.status),i.default.alert("Connection Error","Connection failed. Please try again or contact support.","OK"))}).catch(function(o){window.console.error("[Moodle] Error calling connect.php:",o),i.default.alert("Connection Error","Connection failed. Please try again or contact support.","OK")})}});